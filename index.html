<!doctype html>
	<html lang="en">
		<head>
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
			<meta name="description" content="">
			<meta name="author" content="">

			<title>BeRoute</title>

			<!-- Leaflet -->
			<link rel="stylesheet" href="lib/Leaflet/dist/leaflet.css">

			<!-- Basemaps and layer switcher control -->
	        <link rel="stylesheet" href="lib/leaflet-groupedlayercontrol/dist/leaflet.groupedlayercontrol.min.css">

	        <!-- bootsrtap core CSS -->
			<link rel="stylesheet" href="lib/bootstrap3/css/bootstrap.min.css">

			<!-- Bootstrap slider range-->
			<link rel="stylesheet" href="lib/bootstrap-slider/dist/css/bootstrap-slider.css">

			<!-- Leaflet sidebar -->
	        <link rel="stylesheet" href="lib/sidebar-v2/css/leaflet-sidebar.css">

	        <!-- Font Awesome -->
	    	<link rel="stylesheet" href="css/FontAwesome.css">  
	    	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

			<!-- Font 
			<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" /> -->

			<!-- leaflet-routing-machine -->
			<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css">
	        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==" crossorigin="">
	    	<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"> 
			<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==" crossorigin=""></script>
			<script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

			<!-- Our customized css -->
			<link rel="stylesheet" href="css/test.css"/>


			<!-- js. FILES -->

			<!-- Jquery -->
	        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>	 
			<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>

			<!-- Leaflet -->
	        <script src="lib/Leaflet/dist/leaflet.js"></script>

	        <!-- Leaflet providers -->
			<script src="lib/leaflet-providers-master/leaflet-providers.js"></script>
			
			<!-- Basemaps and layer switcher control -->
	        <script src="lib/leaflet-groupedlayercontrol/dist/leaflet.groupedlayercontrol.min.js"></script>

	        <!-- bootsrtap core CSS -->
	        <script src="lib/bootstrap3/js/bootstrap.min.js"></script>

	        <!-- Bootstrap slider range-->
	       	<script type="text/javascript" src="lib/bootstrap-slider/dist/bootstrap-slider.js"></script>

	       	<!-- Leaflet sidebar -->
	        <script src="lib/sidebar-v2/js/leaflet-sidebar.js"></script>

    	
	        <!-- Data -->
	        <script src="data/emo_json_100.js" type="text/javascript"></script>
	        <script src="data/basemaps.js"></script>
	    	<script src="data/bar.js"></script>
	    	<script src="data/cafe.js"></script>
	    	<script src="data/club.js"></script>
	    	<script src="data/others.js"></script>
	    	<!-- <script src="data/garden.js"></script> -->
	    	<script src="data/pub.js"></script>
	    	<script src="data/restaurant.js"></script>

	        <style>
	    		nav {
	    		    height: 65px;
	    		}
	    		main {
	                
	                overflow: hidden;
	    			padding: 0;
	    			margin: 0;
	            }
	    		#sidebar {
	                top: 100px;
	                position: absolute;
	                height: 80%;
	    			left: 10px;
	                
	            }
	            #map {
	                width: 100%;
	    			top: 65px;
	                position: absolute;
	    			left: 0px;
	    			bottom: 0px;
	    			right:0px;
	            }
	        </style>
	    </head>

	    <body>

	        <!-- Nav bar -->
	        <header>
	            <div class="navigationbar">
	                <b class="navbar-brand" href="#">BeRoute</b>
	                <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
	                    
	                    <!-- <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navigationbar" aria-controls="navigationbar" aria-expanded="false" aria-label="Toggle navigation">
	                        <span class="navbar-toggler-icon"></span>
	                    </button> -->

	                    <ul class="navbar-nav ml-auto">
	                        <li class="nav-item active">
	                            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
	                        </li>
	                        <li class="nav-item">
	                            <a class="nav-link" href="https://github.com/BeRouteCarto/Source">Data</a>
	                        </li>
	                        <li class="nav-item">
	                            <a class="nav-link" href="PDF/About.pdf">About</a>
	                        </li>
	                        <li class="nav-item">
	                            <a class="nav-link" href="#">Contact</a>
	                        </li>
	                    </ul>
	                </nav>
	            </div>
	        </header>

	       <main role="main" class="container-fluid">
		    	<div id="sidebar" class="sidebar collapsed">
		            <!-- Nav tabs -->
		            <div class="sidebar-tabs">
		                <ul role="tablist">
		                    <li><a href="#home" role="tab"><i class="fa fa-bars"></i></a></li>
		                    <li><a href="#mood" role="tab"><i class="fa fa-beer"></i></a></li>
		                    <!-- <li><a href="#time" role="tab"><i class="fa fa-times"></i></a></li>
		                    <li><a href="#type" role="tab"><i class="fa fa-beer"></i></a></li> -->
		                    <!-- <li><a href="#type" role="tab"><i class="fa fa-heart"></i></a></li> -->
		                    <!-- <li><a href="#route" role="tab"><i class="fa fa-location-arrow"></i></a></li> -->
		                    <li><a href="https://github.com/BeRouteCarto/BeRoute" role="tab" target="_blank"><i class="fa fa-github"></i></a></li>
		                </ul>
		                <!-- SETTINGS BUTTON 
		                <ul role="tablist">
		                    <li><a href="#settings" role="tab"><i class="fa fa-gear"></i></a></li>
		                </ul>  
		                -->
		            </div>

		            <!-- Tab panes -->
		            <!-- Filter Tab pane -->
		            <div class="sidebar-content">
		                <div class="sidebar-pane" id="home">
		                    <h1 class="sidebar-header">
		                        Description
		                        <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
		                    </h1>
							</br>
							<p>“BeRoute” is a web-based map application aims to help beer drinkers to find out suitable places for drinking 
							beer and provide them a route to the recommended location in Munich. There are three main parts in this project: 
							emotion scores layer, beer locations and beer routes. Emotion score layer reflects the atmosphere in the space. 
							It helps users to decide which districts they want to go. Beer locations are divided into different categories 
							depending on their types. It helps users decide which kind of place they want to stay for drinking beer. 
							After two-time filtering, users will get suitable locations for them and obtain specific beer routes to these places.</p>
		                </div>
		    			<!-- Mood Selection Tab pane -->
		                <div class="sidebar-pane" id="mood">
		                    <h1 class="sidebar-header">Filter<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
							<h4> Choose Location Type:</h4>
		    				<fieldset class="form-group">						
		                        <div class="row">
								
		                            <div>
		                                <div class="form-check" style="margin-bottom: 10px; margin-top: 10px; margin-left: 15px">
		                                    <input class="form-check-input" type="checkbox" name= "spots" id="Bar" value="Bar">
		                                    <label class="form-check-label" for="Bar">
		                                        Bar
		                                    </label>
		                                </div>
		                                <div class="form-check" style="margin-bottom: 10px; margin-left: 15px;">
		                                    <input class="form-check-input"  type="checkbox" name= "spots" id="Cafe" value="Cafe">
		                                    <label class="form-check-label" for="Cafe">
		                                        Cafe
		                                    </label>
		                                </div>
		                                <div class="form-check" style="margin-bottom: 10px; margin-left: 15px;">
		                                    <input class="form-check-input" type="checkbox" name= "spots" id="Club" value="Club">
		                                    <label class="form-check-label" for="Club">
		                                        Club
		                                    </label>
		                                </div>
										<!-- 
		                                <div class="form-check" style="margin-bottom: 10px;">
		                                    <input class="form-check-input" type="checkbox" name= "spots" id="Park" value="Park">
		                                    <label class="form-check-label" for="Park">
		                                        Park/Garden
		                                    </label>
		                                </div>
										-->
		                                <div class="form-check" style="margin-bottom: 10px; margin-left: 15px;">
		                                    <input class="form-check-input" type="checkbox" name= "spots" id="Pub" value="Pub">
		                                    <label class="form-check-label" for="Pub">
		                                        Pub
		                                    </label>
		                                </div>
		                                <div class="form-check" style="margin-bottom: 10px; margin-left: 15px;">
		                                    <input class="form-check-input" type="checkbox" name= "spots" id="Restauraunt" value="Restauraunt">
		                                    <label class="form-check-label" for="Restauraunt">
		                                        Restauraunt
		                                    </label>
		                                </div>
		                                <div class="form-check" style="margin-bottom: 10px; margin-left: 15px;">
		                                    <input class="form-check-input" type="checkbox" name= "spots" id="Others" value="Others">
		                                    <label class="form-check-label" for="Others">
		                                        Others
		                                    </label>
		                                </div>
		                            </div>
		                        </div>
		                    </fieldset>
							<h4> Emotion state:</h4>
		                    <input id="slider-range-selector-input" type="text"
		    					data-slider-id="slider-range-selector"
		    					data-slider-min="0"
		    					data-slider-max="10"
		    					data-slider-step="0.319803"
		    					data-slider-value="10"
		    					data-slider-rangeHighlights='[
									{"start": 0, "end": 1, "class": "category1"},
						            {"start": 1, "end": 2, "class": "category2"},
						            {"start": 2, "end": 3, "class": "category3"},
						            {"start": 3, "end": 4, "class": "category4"},
						            {"start": 4, "end": 5, "class": "category5"},
						            {"start": 5, "end": 6, "class": "category6"},
						            {"start": 6, "end": 7, "class": "category7"},
						            {"start": 7, "end": 8, "class": "category8"},
						            {"start": 8, "end": 9, "class": "category9"},
						            {"start": 9, "end": 10, "class": "category10"},
		    					]' />
		    				<input id="submit-slider-range-selector" type="submit">
		    			</div>

		                <!-- Time Selection Tab pane -->
		                <!--<div class="sidebar-pane" id="time">
		                    <h1 class="sidebar-header">Time Selection<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
		                </div> -->

		                <!-- Spot types Tab pane 
		                <div class="sidebar-pane active" id="type">
		                    <h1 class="sidebar-header">
		                        Spot Type
		                        <span class="sidebar-close"><i class="fa fa-caret-left"></i></span>
		                    </h1> -->
		                    
		                <!-- Route Tab pane 
		                </div>
		                <div class="sidebar-pane" id="route">
		                    <h1 class="sidebar-header">Route<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
		    			</div> -->

		                <!-- Settings Tab pane -->
		                <!-- <div class="sidebar-pane" id="settings">
		                    <h1 class="sidebar-header">Settings<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
		                </div> -->
		            </div>
		        </div>

		        <div id="map" class="sidebar-map"></div>
		    </main>

		    <script>

		        // Layer and Basemaps switcher control
		        var map = L.map('map', {
		            center: [48.133333, 11.566667],
		            zoom: 11,
		            layers: [Basemaps.Basemaps.DarkMatter, Basemaps.Basemaps.Wikimedia, Basemaps.Basemaps.OpenStreetMap_DE],
		            zoomControl: false
		        });
		        
		        // Customized zoom control
		        L.control.zoom({
     				position:'topright'
				}).addTo(map);

				// Use the custom grouped layer control, not "L.control.layers"
		        L.control.groupedLayers(Basemaps.Basemaps).addTo(map);

		        var MunchenBoundaries = L.geoJson(MunchenBoundaries).addTo(map);

		        var FrameBoundary = map.fitBounds([
		            [48.0616, 11.3608],
		            [48.2482, 11.7229]
		        ]);

		    	var sidebar = L.control.sidebar('sidebar').addTo(map);
		    	
		        $( ".button.open" ).click(function() {
		            $(".form").addClass("unvisible");
		            $(".form").removeClass("visible");
		            $( ".button.close" ).removeClass( "hide" );
		            $( ".button.open" ).addClass( "hide" ); 
		        });

		        $( ".button.close" ).click(function() {
		            $(".form").addClass("visible");
		            $(".form").removeClass("unvisible");
		            $( ".button.open" ).removeClass( "hide" );
		            $( ".button.close" ).addClass( "hide" );    
		        });

		        $( "#sidebar" ).hover(function() {
		                map.dragging.disable();
		                map.touchZoom.disable();
		                map.doubleClickZoom.disable();
		                map.scrollWheelZoom.disable();
		                map.boxZoom.disable();
		                map.keyboard.disable();
		            },
		            function() {
		                map.dragging.enable();
		                map.touchZoom.enable();
		                map.doubleClickZoom.enable();
		                map.scrollWheelZoom.enable();
		                map.boxZoom.enable();
		                map.keyboard.enable();
		            });

		        
				var start = null;
				var marker = null;
				
		        //get current position, the spot selection function need to insert to it
				//for getting the click reaction, variable definition for Spot need to be in this function
				//navigator.geolocation.getCurrentPosition(function(location) {
				//	var start = new L.LatLng(location.coords.latitude, location.coords.longitude);
				//	var marker = L.marker(start).addTo(map);

				//init styles array
				var myStyles = initStyles();
				//Emotion Layer
				//Based on the last version, insert all codes
				var points_emotion = L.geoJson(emo_100_poly, {
		            style:function(feature) {
		                return myStyles[Math.floor(feature.properties.score)];
		            }
				}).addTo(map);
				var sliderRangeSelector = $('#slider-range-selector-input').slider({
		            id: 'slider-range-selector-input',
		            min: 0,
		            max: 10,
		            step: 0.319803,
		            value: [0, 10],
		            rangeHighlights: [
		                //{id: "",  "start": 5.733887, "end": 6.053690, "class": "category1"},
			            //{"start": 6.053690, "end": 6.373493, "class": "category2"},
			            //{"start": 6.373493, "end": 6.693296, "class": "category3"},
			            //{"start": 6.693296, "end": 7.013099, "class": "category4"},
			            //{"start": 7.013099, "end": 7.332902, "class": "category5"},
			            //{"start": 7.332902, "end": 7.652706, "class": "category6"},
			            //{"start": 7.652706, "end": 7.972509, "class": "category7"},
			            //{"start": 7.972509, "end": 8.292312, "class": "category8"},
			            //{"start": 8.292312, "end": 8.612115, "class": "category9"},
			            //{"start": 8.612115, "end": 8.931918, "class": "category10"},
			            {id: "",  "start": 0, "end": 1, "class": "category1"},
			            {"start": 1, "end": 2, "class": "category2"},
			            {"start": 2, "end": 3, "class": "category3"},
			            {"start": 3, "end": 4, "class": "category4"},
			            {"start": 4, "end": 5, "class": "category5"},
			            {"start": 5, "end": 6, "class": "category6"},
			            {"start": 6, "end": 7, "class": "category7"},
			            {"start": 7, "end": 8, "class": "category8"},
			            {"start": 8, "end": 9, "class": "category9"},
			            {"start": 9, "end": 10, "class": "category10"},
		            ],
		            formatter: function (value) {
		                return 'Current value: ' + value;
		            }
				});
				$( "#submit-slider-range-selector" ).click(function() {
					// var myStyle = {
					//  "color": "red",
					//  "weight": 5,
					//  "opacity": 0.65
					// };
					points_emotion.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});

					var selectorValue = sliderRangeSelector.slider('getValue');

					points_emotion = L.geoJson(
							emo_100_poly,
							{
								style:function(feature) {
								return myStyles[Math.floor(feature.properties.score)];
								},
								filter: function (feature, layer) {
								return selectorValue[0] <= Math.floor(feature.properties.score) && selectorValue[1] > Math.floor(feature.properties.score);
								}
							}
							).addTo(map);
						addPointsInPolygons ();
					});

				function initStyles() {
					var styles = [];
					let colors = [
						//'##65000B',
						//'#67001f',
						//'#800026',
						//'#bd0026',
						//'#e31a1c',
						//'#fc4e2a',
						//'#fd8d3c',
						//'#feb24c',
						//'#fed976',
						'#67001f',
						'#a50026',
						'#d73027',
						'#f46d43',
						'#fdae61',
						'#fee08b',
						//'#d9ef8b',
						'#a6d96a',
						'#66bd63',
						'#006837',
						'#00441b',
					];
					for (let i = 1; i <= 10; i++) {
						let style = {
							// "color": getStyleRuleValue('color', "category"+i),
							"color": colors[i],
							"weight": 2,
							"opacity": 0.85
						};
						styles[i]=(style);
					}
					return styles;
				}
							
			    var routeControl = L.Routing.control({
					waypoints: null,
					lineOptions: {
					 	styles:[{"color": "#ff7800","weight": 5,"opacity": 0.65}]
					}
				});
				// spots selection
				//initiate the spot points
				var Bar = L.geoJson(
					bar, 
					{ 
						pointToLayer: function (feature, latlng) { 
							return L.marker(latlng, {icon: BarIcon});
						}
					}
				);

				var Cafe = L.geoJson(
					cafe, 
					{ 
						pointToLayer: function (feature, latlng) { 
							return L.marker(latlng, {icon: CafeIcon});
						}
					}
				);

				var Club = L.geoJson(
					club, 
					{ 
						pointToLayer: function (feature, latlng) { 
							return L.marker(latlng, {icon: ClubIcon});
						}
					}
				);

				var Others = L.geoJson(
					others, 
					{ 
						pointToLayer: function (feature, latlng) { 
							return L.marker(latlng, {icon: OthersIcon});
						}
					}
				);

				//var Park = L.geoJson(park, { pointToLayer: function (feature, latlng) { 
				//return L.marker(latlng, {icon: ParkIcon});}});

				var Pub = L.geoJson(
					pub, 
					{ 
						pointToLayer: function (feature, latlng) { 
							return L.marker(latlng, {icon: PubIcon});
						}
					}
				);

				var Restauraunt = L.geoJson(
					restaurant, 
					{ 
						pointToLayer: function (feature, latlng) { 
							return L.marker(latlng, {icon: RestaurantIcon});
						}
					}
				);

				function addPointsInPolygons() {
					Bar.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});
					Cafe.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});
					Club.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});
					Others.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});
					//Park.getLayers().forEach(function(item, i, arr) {
					//	map.removeLayer(item);
					//});
					Pub.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});
					Restauraunt.getLayers().forEach(function(item, i, arr) {
						map.removeLayer(item);
					});

					if($('#Bar').is(':checked'))
					Bar = L.geoJson(
						bar, 
						{ 
							pointToLayer: function (feature, latlng) { 
								return L.marker(latlng, {icon: BarIcon});
							},
							filter: function (feature, layer) {
			            		let newpoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
				                return points_emotion.getLayers().some(function(element) 
				                	{
				                    	return element.getBounds().contains(newpoints) === true;
				                	}
				                )
			                // return points_emotion.getBounds().contains(some);
							},
			                onEachFeature: function (feature, layer) {
								layer.on('click', function(e) {onClick(e, start,routeControl);});
								if (feature.properties && feature.properties.name) {
									layer.bindPopup(feature.properties.name);}
								}
							}
					).addTo(map);

					if($('#Cafe').is(':checked'))
					Cafe = L.geoJson(
						cafe, 
						{ 
							pointToLayer: function (feature, latlng) { 
								return L.marker(latlng, {icon: CafeIcon});
							},
							filter: function (feature, layer) {
			                    let newpoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
			                    return points_emotion.getLayers().some(function(element) 
			                    	{
			                        	return element.getBounds().contains(newpoints) === true;
			                    	}
			                    )
			                // return points_emotion.getBounds().contains(some);
			                },
			                onEachFeature: function (feature, layer) {
								layer.on('click', function(e) {onClick(e, start,routeControl);});
								if (feature.properties && feature.properties.name) {
									layer.bindPopup(feature.properties.name);}
								}
							}
					).addTo(map);

					if($('#Club').is(':checked'))
					Club = L.geoJson(
						club, 
						{ 
							pointToLayer: function (feature, latlng) { 
								return L.marker(latlng, {icon: ClubIcon});
							},
							filter: function (feature, layer) {
			                    let newpoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
			                    return points_emotion.getLayers().some(function(element) 
			                    	{
			                        	return element.getBounds().contains(newpoints) === true;
			                    	}
			                    );
			                // return points_emotion.getBounds().contains(some);
			                },
			                onEachFeature: function (feature, layer) {
								layer.on('click', function(e) {onClick(e, start,routeControl);});
								if (feature.properties && feature.properties.name) {
									layer.bindPopup(feature.properties.name);}
								}
							}
					).addTo(map);

					if($('#Others').is(':checked'))
					Others = L.geoJson(
						others, 
						{ 
							pointToLayer: function (feature, latlng) { 
								return L.marker(latlng, {icon: OthersIcon});
							},
							filter: function (feature, layer) {
			                    let newpoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
			                    return points_emotion.getLayers().some(function(element) 
			                    	{
			                        	return element.getBounds().contains(newpoints) === true;
			                    	}
			                    );
			                // return points_emotion.getBounds().contains(some);
			                },
			                onEachFeature: function (feature, layer) {
								layer.on('click', function(e) {onClick(e, start,routeControl);});
								if (feature.properties && feature.properties.name) {
									layer.bindPopup(feature.properties.name);}
								}
							}
					).addTo(map);
					
					//if($('#Park').is(':checked'))
					//Park = L.geoJson(
					//	park, 
					//	{ 
					//		pointToLayer: function (feature, latlng) { 
					//			return L.marker(latlng, {icon: ParkIcon});
					//		},
					//		filter: function (feature, layer) {
					//			let NewPoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
					//			return points_emotion.getLayers().some(function(element) {
					//				return element.getBounds().contains(NewPonts) === true;
					//			});
					//			// return points_emotion.getBounds().contains(some);
					//		},
					//		onEachFeature: function (feature, layer) {
					//					layer.on('click', function(e) {onClick(e, start,routeControl);});
					//					if (feature.properties && feature.properties.name) {
					//							layer.bindPopup(feature.properties.name);}
					//		}
					//	}).addTo(map);
				
					if($('#Pub').is(':checked'))
					Pub = L.geoJson(
						pub, 
						{ 
							pointToLayer: function (feature, latlng) { 
								return L.marker(latlng, {icon: PubIcon});
							},
							filter: function (feature, layer) {
			                    let newpoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
			                    return points_emotion.getLayers().some(function(element) 
			                    	{
			                        	return element.getBounds().contains(newpoints) === true;
			                    	}
			                    )
			                // return points_emotion.getBounds().contains(some);
			                },
			                onEachFeature: function (feature, layer) {
								layer.on('click', function(e) {onClick(e, start,routeControl);});
								if (feature.properties && feature.properties.name) {
									layer.bindPopup(feature.properties.name);}
								}
							}
					).addTo(map);
				   

					if($('#Restauraunt').is(':checked'))
					Restauraunt = L.geoJson(
						restaurant, 
						{ 
							pointToLayer: function (feature, latlng) { 
								return L.marker(latlng, {icon: RestaurantIcon});
							},
							filter: function (feature, layer) {
			                    let newpoints = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
			                    return points_emotion.getLayers().some(function(element) 
			                    	{
			                        	return element.getBounds().contains(newpoints) === true;
			                    	}
			                    )
			                // return points_emotion.getBounds().contains(some);
			                },
			                onEachFeature: function (feature, layer) {
								layer.on('click', function(e) {onClick(e, start,routeControl);});
								if (feature.properties && feature.properties.name) {
									layer.bindPopup(feature.properties.name);}
								}
							}
					).addTo(map);
				};

				$('input:checkbox[name="spots"]').change(function () {
					addPointsInPolygons();
				});

				function onEachFeature(feature, layer) {
					layer.on('click', function(e) {onClick(e)});
					if (feature.properties && feature.properties.name) {
						layer.bindPopup(feature.properties.name+"<br>"+feature.properties.Address)}
				}

				function filter (feature, layer) {
					let NewPonts = L.latLng(feature.geometry.coordinates[1], feature.geometry.coordinates[0]);
					return points_emotion.getLayers().some(function(element) {
						return element.getBounds().contains(NewPonts) === true;
					});
					// return points_emotion.getBounds().contains(some);
				}

				//click function
				function onClick(e){

					var end = e.latlng;
					if(start === null)
					{
						navigator.geolocation.getCurrentPosition(function(location) {
							start = new L.LatLng(location.coords.latitude, location.coords.longitude);
							marker = L.marker(start).addTo(map);
							setWaypoints(start, end)
						});
					}
					else
					{
						setWaypoints(start, end)
					}

					//var icon = L.icon({
			        //iconUrl: 'https://cdn1.iconfinder.com/data/icons/Map-Markers-Icons-Demo-PNG/256/Map-Marker-Marker-Outside-Azure.png',
			        //iconSize: [ 48, 48 ],
					//});
					// var layer = e.target;
					//layer.setIcon(layer.options.icon = icon);
			       //e.target.setIcon( new icon);
				}

				function setWaypoints(start, end)
				{
					routeControl.setWaypoints([L.latLng(start),L.latLng(end)]).addTo(map);
				}

				var geojsonMarkerOptions  = {
			      radius: 6,
			      fillColor: "#ff7800",
			      color: "#000",
			      weight: 1,
			      opacity: 1,
			      fillOpacity: 1
			    };

				var Icon = L.Icon.extend({
					options: {
					iconSize:     [30, 30]
				}
				});

				var BarIcon = new Icon({iconUrl: 'img/Bar.png'});
				var	CafeIcon = new Icon({iconUrl: 'img/Cafe.png'});
				var	ClubIcon = new Icon({iconUrl: 'img/Club.png'});
				var	PubIcon = new Icon({iconUrl: 'img/Pub.png'});
				var	RestaurantIcon = new Icon({iconUrl: 'img/Restaurant.png'});
				// var ParkIcon = new Icon({iconUrl: 'img/Park.png'});
				var	OthersIcon = new Icon({iconUrl: 'img/Others.png'});
		    </script>
	    </body>
	</html>
